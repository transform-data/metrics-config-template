version: v0.1
data_source:
  name: transforms_fct
  description: This table captures the number of transformations that the Transformer bots performed, starting in Oct 2020.
  owners:
    - transformer@transformdata.io
  # redshift
  sql_query: |
    SELECT
      n AS id_transformation 
      , CAST(1 + MOD(n, 50) AS INT) AS id_bot
      , CAST(2 + RANDOM()* 10 AS INT) AS m_transforms
      , CAST(ROUND(RANDOM(),0) AS INT) AS dim_is_visible
      , DATE_ADD('day', MOD(n, 20), CAST('2020-10-01' AS DATE)) AS ds
    FROM (SELECT ROW_NUMBER() OVER () AS n FROM information_schema.columns LIMIT 100) AS n

  identifiers:
    - name: tranform
      type: primary
      expr: id_transformation
    - name: bot
      type: foreign
      expr: id_bot

  measures:
    - name: transforms
      description: The total number of transforms performed by the transformer bots.
      expr: m_transforms
      agg: sum
    - name: visible_transforms
      description: The total number of visible transforms performed by the transformer bots.
      expr: CASE WHEN dim_is_visible THEN m_transforms ELSE 0 END
      agg: sum

  dimensions:
    - name: ds
      type: time
    - name: is_visible
      type: categorical
      expr: dim_is_visible

  mutability:
    type: ds_append_only
